# Mason(石工)

---
## 処理概要
* 画像上の、ホールドっぽい場所を検出するよ。
* ボテの上にホールドが乗っかってる場合も、それっぽく区別出来るよ。

---
## 動作概要
* socket通信で、jsonを投げてください。
* 検出結果は、jsonでレスポンスします。

---
## 入力概要
* クライミングウォールの画像
    * ホールドに色がある人工壁を想定、自然の石は無理かも。
* 大まかなホールドの輪郭情報
    * ユーザーが適当にホールドを丸で囲んだ感じを想定。
    * ボテの上にホールドが乗っている場合、輪郭の形状が近い方を選出。

## 入力JSON
下記情報を記載したjsonをsocket通信で投げてください。
* reqCode : 処理のRequestCode (詳細は後述)
* sessionID : セッションの識別ID ( reqCode != 1000 の場合に有効 )
* imagePath : 入力画像パス ( reqCode == 1000 の場合に有効 )
* addContourSeeds[] : 追加したいホールド輪郭の配列 ( reqCode == 2000 の場合に有効 )
    * [] : 輪郭を構築するxy座標の配列(※)
        * x : 画像上のx座標
        * y : 画像上のy座標
* reductContourSeeds[] : 追加したいホールド輪郭の配列 ( reqCode == 2000 の場合に有効 )
    * [] : 輪郭を構築するxy座標の配列(※)
        * x : 画像上のx座標
        * y : 画像上のy座標
* fixedContours[] : 既に座標が決定している輪郭 ( reqCode == 2000 の場合に有効 )
    * [] : 輪郭を構築するxy座標の配列
        * x : 画像上のx座標
        * y : 画像上のy座標
* (※)補足
    * ざっくりでもよいので輪郭情報が入ると精度が高い
    * 最悪、適当なサイズのレクト(長方形の4点)を入力して下さい。

## reqCode
* 1000 : 処理画像の設定
* 2000 : 輪郭検出処理実行
* -1 : セッションの終了

---
## 出力概要
* 検出したホールドの輪郭情報

## 出力JSON
下記情報を記載したjsonを、レスポンスで戻します。
* resCode : 処理のResponseCode ( == 0 成功, > 0 警告あり終了, < 0 処理失敗 )
* sessionID : セッションの識別ID
* contours[] : 輪郭の配列 ( reqCode == 2000 の場合に有効 )
    * [] : 輪郭を構築するxy座標の配列
        * x : 画像上のx座標
        * y : 画像上のy座標

---
## 実行環境、想定精度
* 開発言語 : Python3
    * 依存ライブラリ
        * OpenCV 3.x ( opencv_contrib に対応したもの )
* 想定精度 : 下記の条件ならば 1[s] 未満の処理時間で、 9割くらい成功したい。
    * 画像サイズ : FHD
    * ホールドのサイズ : 100^2[pix]程度
    * 他 : 壁に木目とかペインティングとかされてない。

---
## Pyの使い方
* 起動 : mason_srv.py を引数無しで起動
* socket : mason_param.json をソレっぽく修正して使ってください。

---
## エラー処理
ごめん、あんま作ってないけど、多分下記の感じ。
* 検出失敗 : 入力JSONの輪郭とほぼ同じのが、出力JSONに出力される。
* 不正な入力 : 普通に落ちる

---
### © 2019 YamaLab.
